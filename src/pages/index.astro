<html lang="it">
  <head>
    <meta charset="UTF-8" />
    <title>Catalogo libri</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css" rel="stylesheet"/>
  </head>
  <body class="container mt-5">
    <h1>Catalogo libri</h1>

    <table id="sheetTable" class="table table-striped">
      <thead><tr id="headerRow"></tr></thead>
      <tbody id="bodyRows"></tbody>
    </table>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", async function() {
        try {
          const res = await fetch("https://cfg_googledata.it-e3f.workers.dev/?sheet=1Ef7n23TnmRFfpdzp4D24v0kKDrBxGQnhUPI6CNOASU4&f=A3SD21");
          const data = await res.json();
          const headers = data.values[0];
          const rows = data.values.slice(1);

          // Header
          const headerRow = document.getElementById("headerRow");
          headers.forEach(h => {
            const th = document.createElement("th");
            th.textContent = h;
            headerRow.appendChild(th);
          });

          // Body
          const bodyRows = document.getElementById("bodyRows");
          rows.forEach(r => {
            const tr = document.createElement("tr");
            r.forEach((val, idx) => {
              const td = document.createElement("td");
              // Se la colonna Ã¨ "copertina" o "cdn", mostra immagine
              if (headers[idx] === "copertina" || headers[idx] === "cdn") {
                const img = document.createElement("img");
                img.src = val;
                img.style.maxWidth = "80px";
                td.appendChild(img);
              } else {
                td.textContent = val;
              }
              tr.appendChild(td);
            });
            bodyRows.appendChild(tr);
          });

          $('#sheetTable').DataTable();
        } catch (err) {
          console.error("Errore nel fetch:", err);
          document.getElementById("sheetTable").insertAdjacentHTML("afterend", "<p>Errore nel caricamento dati</p>");
        }
      });
    </script>
  </body>
</html>
