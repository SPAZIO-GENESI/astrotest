---
const sheetId = '1Ef7n23TnmRFfpdzp4D24v0kKDrBxGQnhUPI6CNOASU4';
const apiUrl = `https://cfg_googledata.it-e3f.workers.dev/?sheet=${sheetId}&f=A3SD21`;

// Meta statici (puoi personalizzarli)
const metaTitle = "Tabella Dati";
const metaDesc = "Visualizza i dati dal Google Sheet tramite Worker process.";
---

<html lang="it">
  <head>
    <meta charset="UTF-8" />
    <title>{metaTitle}</title>
    <meta name="description" content={metaDesc} />
    <meta property="og:title" content={metaTitle} />
    <meta property="og:description" content={metaDesc} />

    <!-- Bootstrap CSS -->
    <link 
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" 
      rel="stylesheet"
    />
    <!-- DataTables CSS -->
    <link 
      href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css" 
      rel="stylesheet"
    />
  </head>
  <body class="container mt-5">
    <h1>{metaTitle}</h1>

    <table id="sheetTable" class="table table-striped">
      <thead>
        <tr id="headerRow"></tr>
      </thead>
      <tbody id="bodyRows"></tbody>
    </table>

    <!-- jQuery + DataTables + Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      document.addEventListener("DOMContentLoaded", async function() {
        try {
          const res = await fetch("{apiUrl}");
          const rows = await res.json();

          if (rows.length > 0) {
            // Header
            const headerRow = document.getElementById("headerRow");
            Object.keys(rows[0]).forEach(key => {
              const th = document.createElement("th");
              th.textContent = key;
              headerRow.appendChild(th);
            });

            // Body
            const bodyRows = document.getElementById("bodyRows");
            rows.forEach(row => {
              const tr = document.createElement("tr");
              Object.values(row).forEach(val => {
                const td = document.createElement("td");
                td.textContent = val;
                tr.appendChild(td);
              });
              bodyRows.appendChild(tr);
            });

            // Inizializza DataTable
            $('#sheetTable').DataTable();
          } else {
            document.getElementById("sheetTable").insertAdjacentHTML("afterend", "<p>Nessun dato disponibile</p>");
          }
        } catch (err) {
          console.error("Errore nel fetch:", err);
          document.getElementById("sheetTable").insertAdjacentHTML("afterend", "<p>Errore nel caricamento dati</p>");
        }
      });
    </script>
  </body>
</html>
